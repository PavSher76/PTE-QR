# –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞

## üéØ **–ó–∞–¥–∞—á–∞:**
–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π PDF –¥–æ–∫—É–º–µ–Ω—Ç –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `page_number` –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR –∫–æ–¥–æ–≤.

## ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **1. ‚úÖ –ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

#### **–ú–µ—Ç–æ–¥ `add_qr_codes_to_pdf` (—Å—Ç—Ä–æ–∫–∏ 653-655):**
```python
# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
x_position, y_position, position_info = self._calculate_unified_qr_position(
    page, qr_size_points, pdf_content, page_number - 1  # ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π 0-based –∏–Ω–¥–µ–∫—Å
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- **`page`** - –æ–±—ä–µ–∫—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ PDF
- **`qr_size_points`** - —Ä–∞–∑–º–µ—Ä QR –∫–æ–¥–∞ –≤ —Ç–æ—á–∫–∞—Ö
- **`pdf_content`** - –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ PDF (bytes)
- **`page_number - 1`** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π 0-based –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### **2. ‚úÖ –ú–µ—Ç–æ–¥ `_calculate_unified_qr_position`:**

#### **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```python
def _calculate_unified_qr_position(self, page, qr_size: float, pdf_content_or_path, page_number: int):
    """
    Args:
        page: –°—Ç—Ä–∞–Ω–∏—Ü–∞ PDF
        qr_size: –†–∞–∑–º–µ—Ä QR –∫–æ–¥–∞ –≤ —Ç–æ—á–∫–∞—Ö  
        pdf_content_or_path: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ PDF –∏–ª–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        page_number: –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (0-based)  ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å!
    """
    try:
        # –ü–æ–ª—É—á–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–æ–∫—Å–∞ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –æ–±—ä–µ–∫—Ç–∞ page
        x0 = float(page.mediabox.x0)  # ‚Üê –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        y0 = float(page.mediabox.y0)
        x1 = float(page.mediabox.x1)
        y1 = float(page.mediabox.y1)
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å bottom-right
        base_x, base_y = self.compute_anchor_xy(...)
```

### **3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ `_add_qr_code_to_page`:**

#### **–ò–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:**
```python
# –ë–´–õ–û:
def _add_qr_code_to_page(self, page, qr_image, page_number: int, pdf_path: str = None):

# –°–¢–ê–õ–û:
def _add_qr_code_to_page(self, page, qr_image, page_number: int, pdf_content: bytes = None):
    """
    Args:
        page: PDF page object
        qr_image: QR code image
        page_number: Page number (1-based)
        pdf_content: Original PDF content for analysis  ‚Üê –ò—Å—Ö–æ–¥–Ω—ã–π PDF!
    """
```

#### **–û–±–Ω–æ–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –∞–Ω–∞–ª–∏–∑–∞:**
```python
# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã (0-based)
x_position, y_position, position_info = self._calculate_unified_qr_position(
    page, qr_size, pdf_content, page_number - 1  # ‚Üê pdf_content –≤–º–µ—Å—Ç–æ pdf_path
)
```

## üîß **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è:**

### **‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –∞–Ω–∞–ª–∏–∑–∞:**

```
1. add_qr_codes_to_pdf(pdf_content, ...)
   ‚Üì
2. for i, page in enumerate(reader.pages):  # –ò—Å—Ö–æ–¥–Ω—ã–π PDF!
   ‚Üì 
3. page_number = i + 1  # 1-based –Ω–æ–º–µ—Ä
   ‚Üì
4. _calculate_unified_qr_position(page, qr_size, pdf_content, page_number - 1)
   ‚Üì                                                          ‚Üë
5. –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:                                0-based –∏–Ω–¥–µ–∫—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   - page (–∏—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
   - pdf_content (–∏—Å—Ö–æ–¥–Ω—ã–π PDF)  
   - page_number - 1 (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å)
```

### **‚ùå –ù–ï–¢ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:**

- **–ù–∏–∫–∞–∫–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö PDF** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **–ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞** —Å –∏—Å—Ö–æ–¥–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º
- **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** —Å—Ç—Ä–∞–Ω–∏—Ü
- **–ë–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤** –Ω–∞ –¥–∏—Å–∫–µ

## üìä **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏:**

### **‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `add_qr_codes_to_pdf`:**

```python
reader = PdfReader(BytesIO(pdf_content))  # ‚Üê –ò—Å—Ö–æ–¥–Ω—ã–π PDF –≤ –ø–∞–º—è—Ç–∏

for i, page in enumerate(reader.pages):  # ‚Üê –ò—Å—Ö–æ–¥–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    page_number = i + 1  # ‚Üê 1-based –Ω–æ–º–µ—Ä –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    
    # –ê–Ω–∞–ª–∏–∑ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
    x_position, y_position, position_info = self._calculate_unified_qr_position(
        page,           # ‚Üê –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞  
        qr_size_points, # ‚Üê –†–∞–∑–º–µ—Ä QR
        pdf_content,    # ‚Üê –ò—Å—Ö–æ–¥–Ω—ã–π PDF (bytes)
        page_number - 1 # ‚Üê 0-based –∏–Ω–¥–µ–∫—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    )
```

### **‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `_calculate_unified_qr_position`:**

```python
# –ü–æ–ª—É—á–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–æ–∫—Å–∞ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
x0 = float(page.mediabox.x0)  # ‚Üê –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
y0 = float(page.mediabox.y0)  
x1 = float(page.mediabox.x1)
y1 = float(page.mediabox.y1)

# TODO: –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —à—Ç–∞–º–ø–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º page_number
# dx, dy = self.pdf_analyzer.compute_heuristics_delta(pdf_content_or_path, page_number)
dx, dy = 0.0, 0.0  # ‚Üê –ü–æ–∫–∞ –±–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å (–±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–æ–≤)
```

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

### **‚úÖ –ê–ù–ê–õ–ò–ó –ò–°–•–û–î–ù–û–ì–û PDF –î–û–ö–£–ú–ï–ù–¢–ê –ò–°–ü–†–ê–í–õ–ï–ù:**

1. **‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å—Ö–æ–¥–Ω—ã–π PDF** (`pdf_content`)
2. **‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã** (`page_number - 1` –¥–ª—è 0-based)
3. **‚úÖ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ** (`page.mediabox`)
4. **‚úÖ –ù–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
5. **‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### **üîç –ì–æ—Ç–æ–≤–æ –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç–µ:**

- **–ê–Ω–∞–ª–∏–∑ —à—Ç–∞–º–ø–∞** –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pdf_content` –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `page_number`
- **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

## üìã **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑ —à—Ç–∞–º–ø–∞** –≤ `pdf_analyzer`
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pdf_content` –∏ `page_number`** –≤ –∞–Ω–∞–ª–∏–∑–µ  
3. **–í–µ—Ä–Ω—É—Ç—å –¥–µ–ª—å—Ç—ã** (`dx, dy`) –≤–º–µ—Å—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

**–û—Å–Ω–æ–≤–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≥–æ—Ç–æ–≤–∞!** üöÄ

