# –ö—Ä–∞—Ç–∫–∞—è —Å—Ö–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
1. **–î–æ–∫—É–º–µ–Ω—Ç** (Document) - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º `doc_uid`
2. **–†–µ–≤–∏–∑–∏—è** (Revision) - –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ (A, B, C, etc.)
3. **–°—Ç—Ä–∞–Ω–∏—Ü–∞** (Page) - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Ä–µ–≤–∏–∑–∏–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:
- `is_actual` - —Ñ–ª–∞–≥ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `superseded_by` - ID –¥–æ–∫—É–º–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–º–µ–Ω–∏–ª —Ç–µ–∫—É—â–∏–π
- `business_status` - –±–∏–∑–Ω–µ—Å-—Å—Ç–∞—Ç—É—Å (APPROVED_FOR_CONSTRUCTION, ACCEPTED_BY_CUSTOMER, etc.)
- `enovia_state` - —Å—Ç–∞—Ç—É—Å –≤ —Å–∏—Å—Ç–µ–º–µ ENOVIA PLM
- `released_at` - –¥–∞—Ç–∞ –≤—ã–ø—É—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

### 1. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞
```
QR-–∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç: doc_uid + revision + page + timestamp + signature
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ HMAC
```
–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏
```

### 3. –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ
```
–ö–ª—é—á –∫—ç—à–∞: status:{doc_uid}:{revision}:{page}:{auth_status}
TTL: 15 –º–∏–Ω—É—Ç
```

### 4. –ó–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```sql
SELECT * FROM documents 
WHERE doc_uid = ? AND is_actual = true
```

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ENOVIA
```
GET /api/v1/documents/{doc_uid}/revisions/{revision}
OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```

### 6. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
```python
def is_actual(document):
    return (
        document.is_actual == True and
        document.superseded_by is None and
        document.enovia_state in ["Released", "AFC", "Accepted", "Approved"] and
        document.released_at is not None
    )
```

## üìä –°—Ç–∞—Ç—É—Å—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –ë–∏–∑–Ω–µ—Å-—Å—Ç–∞—Ç—É—Å—ã:
- **APPROVED_FOR_CONSTRUCTION** - –æ–¥–æ–±—Ä–µ–Ω –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
- **ACCEPTED_BY_CUSTOMER** - –ø—Ä–∏–Ω—è—Ç –∑–∞–∫–∞–∑—á–∏–∫–æ–º  
- **CHANGES_INTRODUCED_GET_NEW** - –≤–Ω–µ—Å–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
- **IN_WORK** - –≤ —Ä–∞–±–æ—Ç–µ

### –°—Ç–∞—Ç—É—Å—ã ENOVIA:
- **Released** ‚Üí APPROVED_FOR_CONSTRUCTION
- **AFC** ‚Üí APPROVED_FOR_CONSTRUCTION
- **Accepted** ‚Üí ACCEPTED_BY_CUSTOMER
- **Approved** ‚Üí ACCEPTED_BY_CUSTOMER
- **Obsolete** ‚Üí CHANGES_INTRODUCED_GET_NEW
- **Superseded** ‚Üí CHANGES_INTRODUCED_GET_NEW
- **In Work** ‚Üí IN_WORK
- **Frozen** ‚Üí IN_WORK

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ

### –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- GDPR-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –æ—Ç–≤–µ—Ç

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å—Ç–∞—Ç—É—Å–∞
- –ü–æ–ø–∞–¥–∞–Ω–∏—è/–ø—Ä–æ–º–∞—Ö–∏ –∫—ç—à–∞
- –ó–∞–ø—Ä–æ—Å—ã –∫ ENOVIA
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API
- –û—à–∏–±–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- –ê—É–¥–∏—Ç –¥–æ—Å—Ç—É–ø–∞

## üöÄ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–ø—Ä–æ—Å:
```
GET /api/v1/documents/DOC-001/revisions/A/status?page=1
```

### –û—Ç–≤–µ—Ç (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç):
```json
{
  "doc_uid": "DOC-001",
  "revision": "A", 
  "page": 1,
  "is_actual": true,
  "business_status": "APPROVED_FOR_CONSTRUCTION",
  "enovia_state": "RELEASED",
  "released_at": "2024-01-15T10:30:00Z",
  "superseded_by": null
}
```

### –û—Ç–≤–µ—Ç (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π –¥–æ–∫—É–º–µ–Ω—Ç):
```json
{
  "doc_uid": "DOC-001",
  "revision": "A",
  "page": 1, 
  "is_actual": false,
  "business_status": "CHANGES_INTRODUCED_GET_NEW",
  "enovia_state": "SUPERSEDED",
  "superseded_by": "DOC-001-B"
}
```
