# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —è–∫–æ—Ä—è bottom-right

## üéØ **–ó–∞–¥–∞—á–∞:**
–ó–∞–∫—Ä–µ–ø–∏—Ç—å —è–∫–æ—Ä—å `bottom-right` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–ª—å–∫–æ –∫–∞–∫ –¥–µ–ª—å—Ç—É.

## ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

### **1. –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `_calculate_unified_qr_position`:**

**–ë—ã–ª–æ:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –∏–∑ pdf_analyzer
x_position, y_position = self.pdf_analyzer.compute_qr_anchor(
    page_box=page_box,
    qr_size=qr_size,
    rotation=rotation
)
```

**–°—Ç–∞–ª–æ:**
```python
# 1. –°–ù–ê–ß–ê–õ–ê –≤—ã—á–∏—Å–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å bottom-right —Å —É—á–µ—Ç–æ–º rotation
base_x, base_y = self.compute_anchor_xy(
    W=page_width,
    H=page_height, 
    qr_w=qr_size,
    qr_h=qr_size,
    margin=settings.QR_MARGIN_PT,
    rotation=rotation,
    anchor=settings.QR_ANCHOR
)

# 2. –ü–û–¢–û–ú –ø–æ–ª—É—á–∞–µ–º –¥–µ–ª—å—Ç—É –æ—Ç —ç–≤—Ä–∏—Å—Ç–∏–∫ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
dx, dy = self.pdf_analyzer.compute_heuristics_delta(pdf_path, page_number)

# 3. –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–µ–ª—å—Ç—É –∫ –±–∞–∑–æ–≤–æ–º—É —è–∫–æ—Ä—é
x_position = base_x + dx
y_position = base_y + dy

# 4. –ö–ª—ç–º–ø–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã
x_position = max(0, min(x_position, page_width - qr_size))
y_position = max(0, min(y_position, page_height - qr_size))
```

### **2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

**–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç DEBUG –ª–æ–≥–æ–≤:**
```python
debug_logger.info("üîç COORDINATE PIPELINE AUDIT - Detailed calculation", 
                page=page_number,
                box=coordinate_info.get("active_box_type", "media"),
                W=page_width,
                H=page_height,
                rot=rotation,
                anchor=settings.QR_ANCHOR,
                qr=(qr_size, qr_size),
                margin=settings.QR_MARGIN_PT,
                base=(base_x, base_y),      # ‚Üê –ë–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å
                delta=(dx, dy),             # ‚Üê –î–µ–ª—å—Ç–∞ —ç–≤—Ä–∏—Å—Ç–∏–∫
                final=(x_position, y_position),  # ‚Üê –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                respect_rotation=settings.QR_RESPECT_ROTATION)
```

### **3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:**

**Fallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ layout_info:**
```python
# Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å –±–µ–∑ —ç–≤—Ä–∏—Å—Ç–∏–∫
base_x, base_y = self.compute_anchor_xy(
    W=page_width,
    H=page_height,
    qr_w=qr_size,
    qr_h=qr_size,
    margin=settings.QR_MARGIN_PT,
    rotation=rotation,
    anchor=settings.QR_ANCHOR
)
```

**Fallback –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏:**
```python
# Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å –±–µ–∑ —ç–≤—Ä–∏—Å—Ç–∏–∫
base_x, base_y = self.compute_anchor_xy(...)
```

## üîß **–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**

### **1. –ñ—ë—Å—Ç–∫–∏–π —è–∫–æ—Ä—å:**
- –ë–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å `bottom-right` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è **–ü–ï–†–í–´–ú**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ (0¬∞/90¬∞/180¬∞/270¬∞)
- –Ø–∫–æ—Ä—å **–ù–ï –ó–ê–í–ò–°–ò–¢** –æ—Ç —ç–≤—Ä–∏—Å—Ç–∏–∫

### **2. –≠–≤—Ä–∏—Å—Ç–∏–∫–∏ –∫–∞–∫ –¥–µ–ª—å—Ç–∞:**
- –≠–≤—Ä–∏—Å—Ç–∏–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ **–º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏** (¬±50 pt –º–∞–∫—Å–∏–º—É–º)
- –î–µ–ª—å—Ç–∞ **–ù–ï –ú–û–ñ–ï–¢** "–ø–æ–¥–Ω—è—Ç—å" QR –≤ –≤–µ—Ä—Ö
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞: `final = base + delta`

### **3. –ö–ª—ç–º–ø –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**
- –§–∏–Ω–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `x = max(0, min(x, W - qr_w))`
- `y = max(0, min(y, H - qr_h))`

## üìä **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

### **–î–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ 0¬∞:**
- **–ë–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å**: `(W - margin - qr_w, margin)`
- **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏**: –º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ ¬±50 pt
- **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è**: –±–ª–∏–∑–∫–æ –∫ –Ω–∏–∂–Ω–µ–º—É –ø—Ä–∞–≤–æ–º—É —É–≥–ª—É

### **–î–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ 90¬∞:**
- **–ë–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å**: `(margin, margin)` (–≤–∏–∑—É–∞–ª—å–Ω—ã–π –Ω–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π)
- **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏**: –º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ ¬±50 pt
- **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è**: –±–ª–∏–∑–∫–æ –∫ –≤–∏–∑—É–∞–ª—å–Ω–æ–º—É –Ω–∏–∂–Ω–µ–º—É –ø—Ä–∞–≤–æ–º—É

### **–î–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ 180¬∞:**
- **–ë–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å**: `(margin, H - margin - qr_h)` (–≤–∏–∑—É–∞–ª—å–Ω—ã–π –Ω–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π)
- **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏**: –º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ ¬±50 pt
- **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è**: –±–ª–∏–∑–∫–æ –∫ –≤–∏–∑—É–∞–ª—å–Ω–æ–º—É –Ω–∏–∂–Ω–µ–º—É –ø—Ä–∞–≤–æ–º—É

### **–î–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ 270¬∞:**
- **–ë–∞–∑–æ–≤—ã–π —è–∫–æ—Ä—å**: `(W - margin - qr_w, H - margin - qr_h)` (–≤–∏–∑—É–∞–ª—å–Ω—ã–π –Ω–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π)
- **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏**: –º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ ¬±50 pt
- **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è**: –±–ª–∏–∑–∫–æ –∫ –≤–∏–∑—É–∞–ª—å–Ω–æ–º—É –Ω–∏–∂–Ω–µ–º—É –ø—Ä–∞–≤–æ–º—É

## üéØ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

‚úÖ **–Ø–∫–æ—Ä—å `bottom-right` –∑–∞–∫—Ä–µ–ø–ª–µ–Ω** - –≤—Å–µ–≥–¥–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
‚úÖ **–≠–≤—Ä–∏—Å—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –¥–µ–ª—å—Ç–∞** - —Ç–æ–ª—å–∫–æ –º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
‚úÖ **–ü–æ–≤–æ—Ä–æ—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - –≤–∏–∑—É–∞–ª—å–Ω—ã–π –Ω–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª
‚úÖ **–ö–ª—ç–º–ø –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç** - –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é! üöÄ
