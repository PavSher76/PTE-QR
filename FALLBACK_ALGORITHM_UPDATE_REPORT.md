# –û—Ç—á–µ—Ç –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ fallback –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR –∫–æ–¥–∞

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

Fallback –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR –∫–æ–¥–∞ –±—ã–ª —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

> **–ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è fallback –∞–ª–≥–æ—Ä–∏—Ç–º–∞:**
> - **Fallback 1:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –≤–¥–æ–ª—å –Ω–∏–∂–Ω–µ–π —Ä–∞–º–∫–∏ –∏ –≤–¥–æ–ª—å –ø—Ä–∞–≤–æ–π —Ä–∞–º–∫–∏ —á–µ—Ä—Ç–µ–∂–∞
> - **Fallback 2:** 1 —Å–º –æ—Ç—Å—Ç—É–ø –æ—Ç –Ω–∏–∂–Ω–µ–≥–æ –ø—Ä–∞–≤–æ–≥–æ —É–≥–ª–∞ –ª–∏—Å—Ç–∞

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ fallback –∞–ª–≥–æ—Ä–∏—Ç–º–∞

#### 1.1. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_calculate_landscape_qr_position()`
- **–§–∞–π–ª:** `backend/app/services/pdf_service.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
  - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω fallback –∞–ª–≥–æ—Ä–∏—Ç–º
  - –£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —à—Ç–∞–º–ø–∞
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ fallback —É—Ä–æ–≤–Ω–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### ‚úÖ 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è FALLBACK 1: –ü–æ–∑–∏—Ü–∏—è –≤–¥–æ–ª—å —Ä–∞–º–æ–∫

#### 2.1. –õ–æ–≥–∏–∫–∞ FALLBACK 1
```python
# FALLBACK 1: Position along bottom and right frame edges
if bottom_frame_edge is not None and right_frame_edge is not None:
    # Y position: above bottom frame with margin
    # X position: left of right frame with margin
elif right_frame_edge is not None:
    # Y position: use default (bottom area)
    # X position: left of right frame with margin
elif bottom_frame_edge is not None:
    # Y position: above bottom frame with margin
    # X position: use default (left area)
```

#### 2.2. –í–∞—Ä–∏–∞–Ω—Ç—ã FALLBACK 1
- **–û–±–µ —Ä–∞–º–∫–∏ –Ω–∞–π–¥–µ–Ω—ã:** –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–¥–æ–ª—å –Ω–∏–∂–Ω–µ–π –∏ –ø—Ä–∞–≤–æ–π —Ä–∞–º–∫–∏
- **–¢–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞—è —Ä–∞–º–∫–∞:** –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–¥–æ–ª—å –ø—Ä–∞–≤–æ–π —Ä–∞–º–∫–∏
- **–¢–æ–ª—å–∫–æ –Ω–∏–∂–Ω—è—è —Ä–∞–º–∫–∞:** –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–¥–æ–ª—å –Ω–∏–∂–Ω–µ–π —Ä–∞–º–∫–∏

### ‚úÖ 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è FALLBACK 2: –ù–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª

#### 3.1. –õ–æ–≥–∏–∫–∞ FALLBACK 2
```python
# FALLBACK 2: 1 cm offset from bottom-right corner of the page
margin_cm = 1.0  # 1 cm margin from edges
margin_points = margin_cm * 28.35

# Position QR code 1 cm from bottom-right corner
x_position = page_width - qr_size - margin_points
y_position = margin_points
```

#### 3.2. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ FALLBACK 2
- **–û—Ç—Å—Ç—É–ø:** 1 —Å–º –æ—Ç –ø—Ä–∞–≤–æ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è –ª–∏—Å—Ç–∞
- **–ü–æ–∑–∏—Ü–∏—è:** –ù–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ö–æ–≥–¥–∞ —Ä–∞–º–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

## –ò–µ—Ä–∞—Ä—Ö–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

### 1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ù–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
- –ü–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ 3.5x3.5 —Å–º –≤ –Ω–∏–∂–Ω–µ–º –ª–µ–≤–æ–º —É–≥–ª—É
- –í–¥–æ–ª—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏ –¥–ª–∏–Ω–æ–π –Ω–µ –º–µ–Ω–µ–µ 18 —Å–º
- –í–¥–æ–ª—å –ø—Ä–∞–≤–æ–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π —Ä–∞–º–∫–∏ —á–µ—Ä—Ç–µ–∂–∞

### 2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: FALLBACK 1 (–†–∞–º–∫–∏)
- **2.1:** –û–±–µ —Ä–∞–º–∫–∏ –Ω–∞–π–¥–µ–Ω—ã ‚Üí –ø–æ–∑–∏—Ü–∏—è –≤–¥–æ–ª—å –Ω–∏–∂–Ω–µ–π –∏ –ø—Ä–∞–≤–æ–π —Ä–∞–º–∫–∏
- **2.2:** –¢–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞—è —Ä–∞–º–∫–∞ ‚Üí –ø–æ–∑–∏—Ü–∏—è –≤–¥–æ–ª—å –ø—Ä–∞–≤–æ–π —Ä–∞–º–∫–∏  
- **2.3:** –¢–æ–ª—å–∫–æ –Ω–∏–∂–Ω—è—è —Ä–∞–º–∫–∞ ‚Üí –ø–æ–∑–∏—Ü–∏—è –≤–¥–æ–ª—å –Ω–∏–∂–Ω–µ–π —Ä–∞–º–∫–∏

### 3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: FALLBACK 2 (–£–≥–æ–ª)
- –†–∞–º–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã ‚Üí 1 —Å–º –æ—Ç –Ω–∏–∂–Ω–µ–≥–æ –ø—Ä–∞–≤–æ–≥–æ —É–≥–ª–∞ –ª–∏—Å—Ç–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û—Ç—Å—Ç—É–ø—ã –∏ –º–∞—Ä–≥–∏–Ω—ã
- **FALLBACK 1:** 0.5 —Å–º –æ—Ç—Å—Ç—É–ø –æ—Ç —Ä–∞–º–æ–∫
- **FALLBACK 2:** 1.0 —Å–º –æ—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞–µ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã:** 1 —Å–º –æ—Ç –∫—Ä–∞–µ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–Ω–∏—Ü
```python
# Ensure QR code doesn't go off the page
max_y = page_height - qr_size - (1.0 * 28.35)  # 1 cm from top
y_position = min(y_position, max_y)

min_x = 1.0 * 28.35  # 1 cm from left edge
x_position = max(x_position, min_x)
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ fallback —É—Ä–æ–≤–Ω—è:
- üîç "New algorithm failed, falling back to frame-based algorithm"
- üìç "Using FALLBACK 1: Position along bottom and right frame edges"
- üìç "Using FALLBACK 2: 1 cm offset from bottom-right corner"
- ‚úÖ "FALLBACK 2 positioning" —Å –¥–µ—Ç–∞–ª—è–º–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- **–§–∞–π–ª:** `test_real_document.pdf`
- **–†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã:** 612.0 x 792.0 —Ç–æ—á–µ–∫ (A4)
- **–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:** Portrait
- **–ù–∞–π–¥–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:** –ù–µ—Ç —Ä–∞–º–æ–∫ (–æ–∂–∏–¥–∞–µ–º–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ñ–∞–π–ª–∞)

### ‚úÖ FALLBACK 2 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–û–∂–∏–¥–∞–µ–º–∞—è –ø–æ–∑–∏—Ü–∏—è:** (17.1, 1.0) —Å–º
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è:** (17.1, 1.0) —Å–º
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ FALLBACK 2 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: 1
- ‚ùå –ù–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: 0
- üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º: FALLBACK 2: 1 —Å–º –æ—Ç –Ω–∏–∂–Ω–µ–≥–æ –ø—Ä–∞–≤–æ–≥–æ —É–≥–ª–∞
- ‚úÖ QR –∫–æ–¥ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –ù–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- ‚úÖ Fallback —É—Ä–æ–≤–Ω–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Fallback –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR –∫–æ–¥–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

1. **FALLBACK 1** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç QR –∫–æ–¥ –≤–¥–æ–ª—å –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–∞–º–æ–∫ —á–µ—Ä—Ç–µ–∂–∞
2. **FALLBACK 2** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –Ω–∏–∂–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É —Å –æ—Ç—Å—Ç—É–ø–æ–º 1 —Å–º
3. **–ò–µ—Ä–∞—Ä—Ö–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª—é–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö fallback —É—Ä–æ–≤–Ω–µ–π

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º fallback –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º.
